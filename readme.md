# 股票分析程序需求文档

## 项目背景
本程序旨在为用户提供便捷的股票历史数据查询与分析功能。通过输入股票代码，程序能够获取该股票的近10年股价走势，以K线图形式呈现，并计算近10年的年平均回报率，为投资决策提供数据支持。

## 功能需求

### 核心功能
1. **股票数据获取**
   - 用户输入单个或多个股票代码，并以逗号分隔，每个代码后可附加投资占比（格式如“代码1:占比1,代码2:占比2”）。
   - 程序通过API从数据源（AKshare）获取股票的历史数据。
   - 数据范围：过去10年（每日收盘价、开盘价、最高价、最低价、成交量）。

2. **投资组合计算**
   - 基于输入的多个股票代码及其投资占比，计算投资组合的总回报率和年平均回报率：
     - 总回报率公式：
       \[ \text{总回报率} = \sum_{i=1}^n \text{占比}_i \times \text{个股回报率}_i \]
     - 年平均回报率公式：
       \[ \text{年平均回报率} = \left(1 + \text{总回报率}\right)^{1/10} - 1 \]
   - 输出每只股票的回报率及投资组合的整体回报率。

3. **K线图生成**
   - 基于获取的历史数据，生成每只股票的K线图，显示开盘价、收盘价、最高价、最低价的走势。
   - K线图需支持缩放与滑动功能（如果是GUI应用）。

4. **风险分析**
   - 计算每只股票的波动率（年化标准差）作为风险指标：
     \[ \text{波动率} = \sqrt{\frac{1}{n-1} \sum_{i=1}^n (r_i - \bar{r})^2} \]
     其中，\( r_i \)为每日回报率，\( \bar{r} \)为平均回报率。
   - 计算投资组合的风险：基于各个股票的波动率和占比，估算组合波动率。
   - 提供最大回撤分析：
     \[ \text{最大回撤} = \max_{i < j} \left( \frac{\text{股价}_i - \text{股价}_j}{\text{股价}_i} \right) \]
   - 在结果中展示风险分析结果及其对投资决策的影响。

5. **结果展示**
   - 在可视化界面中展示每只股票的K线图及其年平均回报率，同时展示投资组合的整体回报率和风险分析结果。
   - 提供导出功能，将K线图和数据保存为本地文件（PNG、CSV格式）。

### 附加功能
- 数据缓存：减少重复请求的数据量，提高程序性能。
- 投资组合对比：支持对比多个投资组合的回报率与风险。

## 技术需求

### 前端设计
- **交互方式**：
  - 图形用户界面（GUI）。
  - 选用Tkinter框架。

- **数据展示**：
  - 使用Matplotlib可视化库生成K线图和投资组合回报率的可视化图表。

### 后端设计
- **数据获取**：
  - 通过调用金融数据API（如AKshare API）获取历史股价数据。

- **逻辑实现**：
  - 数据清洗与处理。
  - 年平均回报率、投资组合回报率的计算模块。
  - 风险分析模块：波动率、最大回撤计算。
  - 图表绘制模块。

### 数据存储
- 使用MySQL数据库保存。


## 实现步骤

1. **环境搭建**
   - 安装Python及相关依赖库（如pandas、numpy、matplotlib、requests、plotly等）。

2. **数据获取模块开发**
   - 确定API接口并实现股票历史数据的抓取。
   - 编写数据清洗和存储功能。

3. **计算模块开发**
   - 实现单只股票回报率的计算公式。
   - 实现投资组合总回报率和年平均回报率的计算模块。
   - 添加波动率、最大回撤等风险分析计算。
   - 处理缺失值及异常数据。

4. **可视化模块开发**
   - 使用Matplotlib生成每只股票的K线图。
   - 添加投资组合回报率和风险分析的可视化功能。

5. **结果展示模块开发**
   - 实现交互界面，展示所有数据和图表。

6. **测试与优化**
   - 使用多种股票数据和投资组合进行测试。
   - 优化程序性能和错误处理。

7. **文档与发布**
   - 编写用户手册。
   - 打包程序并发布。

## 关键API或工具
- **数据来源**：AKshare
- **开发工具**：
  - 数据处理：pandas、numpy。
  - 可视化：matplotlib
  - GUI（可选）：Tkinter、PyQt。



